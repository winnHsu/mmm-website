"use strict";(self.webpackChunksolanum=self.webpackChunksolanum||[]).push([[315],{696:(t,e,i)=>{i.a(t,async(t,s)=>{try{i.d(e,{default:()=>l});const{default:t}=await i.e(696).then(i.bind(i,315)),{default:r}=await i.e(954).then(i.bind(i,954)),{delegateEventListener:n}=await i.e(449).then(i.bind(i,449)),{initConditional:a}=await i.e(947).then(i.bind(i,947)),o={};class h{constructor(t,e={}){this.bindMethods(),this.element=t,this.action=t.getAttribute("action"),this.method=t.getAttribute("method")||"post",this.submitButton=t.querySelector(".form-submit"),this.options={...o,...e},t.addEventListener("submit",this.submit),this.initFields(),t.formInstance=this}get data(){return new FormData(this.element)}bindMethods(){this.submit=this.submit.bind(this)}dispatchEvent(t,e={}){this.element.dispatchEvent(new CustomEvent(t,{detail:e,bubbles:!0}))}initFields(){this.element.querySelectorAll("[data-condition]").forEach(a),this.submitButton.inert=!0;try{turnstile.render(this.element.querySelector(".turnstile"),{sitekey:this.element.dataset.sitekey,callback:()=>{this.turnstileReady=!0,this.submitButton.inert=!1}})}catch(t){this.element.querySelector(".turnstile").append("Error while loading turnstile.")}}submit(e){e&&e.preventDefault(),this.turnstileReady&&!this.xhr&&(this.element.dataset.loading=!0,this.clearErrorMessages(),this.xhr=new t({url:this.action,method:this.method,data:this.data,onSuccess:t=>{if(this.element.dataset.loading=!1,!t.is_valid)return this.handleErrors(t);this.handleConfirmation(t)},onError:()=>{this.element.dataset.loading=!1},onLoadEnd:()=>{this.xhr=null}}))}clearErrorMessages(){this.element.querySelectorAll(".form-item:has(.form-error)").forEach(t=>{const e=t.querySelector(".form-error");t.querySelectorAll("[aria-invalid]").forEach(t=>{t.removeAttribute("aria-invalid"),t.setAttribute("aria-describedby",t.getAttribute("aria-describedby").replace(e.id,"").trim())}),e.remove()}),this.element.querySelector(".form-status")?.remove()}handleErrors(t){if(t.validation_message){const e=document.createElement("p");e.classList.add("form-status"),e.tabIndex=-1,e.dataset.status="error",e.textContent=t.validation_message,this.element.insertBefore(e,this.element.firstElementChild),e.focus()}if(t.validation_messages)for(const[e,i]of Object.entries(t.validation_messages)){const t=this.element.querySelector(`[data-key="${e}"]`),s=t.querySelectorAll('[name]:not([type="hidden"])'),r=document.createElement("p");r.id=`${s[0].id}-error`,r.classList.add("form-error"),r.innerHTML=i,t.appendChild(r),s.forEach(t=>{t.setAttribute("aria-invalid",!0),t.setAttribute("aria-describedby",`${r.id} ${t.getAttribute("aria-describedby")??""}`.trim())})}this.element.querySelector('[aria-invalid="true"]')?.focus()}handleConfirmation(t){switch(t.confirmation_type){case"redirect":this.element.dataset.loading=!0,location.href=t.confirmation_redirect;break;case"message":const e=this.element.getBoundingClientRect();scrollTo(0,e.top+scrollY-innerHeight/3),this.element.dispatchEvent(new CustomEvent("confirmation",{bubbles:!0})),this.element.outerHTML=t.confirmation_message}}}class d extends h{constructor(t){super(t),this.pages=Array.from(t.querySelectorAll(".form-page")),this.footers=Array.from(t.querySelectorAll(".form-footer")),this.currentIndex=0,n(t,"click",".form-prev button",this.prev),n(t,"click",".form-next button",this.next)}get currentIndex(){return this.pages.findIndex(t=>!t.inert)}set currentIndex(t){t=Math.min(Math.max(0,t),this.pages.length-1),this.pages.forEach((e,i)=>{e.inert=i!==t}),this.footers.forEach((e,i)=>{e.inert=i!==t});const e=r.getFocusableElements(this.pages[t]);e.length&&e[0].focus(),this.updateHeight()}bindMethods(){super.bindMethods(),this.prev=this.prev.bind(this),this.next=this.next.bind(this)}prev(){const t=this.currentIndex;this.currentIndex=t-1,this.dispatchEvent("prev",this.currentIndex)}next(){if(this.xhr)return;const e=this.currentIndex;this.xhr=new t({url:this.pages[e].dataset.validate,method:this.method,data:this.data,onLoadStart:()=>{this.clearErrorMessages(),this.updateHeight(),this.element.dataset.loading=!0},onLoadEnd:()=>{this.xhr=null,this.element.dataset.loading=!1},onSuccess:t=>{if(!t.is_valid)return this.handleErrors(t);this.currentIndex=e+1,this.dispatchEvent("next",{page:this.currentIndex,response:t})}})}updateHeight(){this.element.style.setProperty("--form-h",`${this.pages[this.currentIndex].offsetHeight}px`)}submit(t){if(t&&t.preventDefault(),this.currentIndex<this.pages.length-1)return this.next();super.submit(t)}handleErrors(t){super.handleErrors(t),this.updateHeight()}}const l=t=>{t.querySelector(".form-page")?new d(t):new h(t)};s()}catch(t){s(t)}},1)}}]);